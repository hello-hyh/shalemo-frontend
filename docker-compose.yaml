version: '3.8'

services:
  shalemo-app:
    # 构建当前目录下的Dockerfile
    build: .
    # 容器名称
    container_name: shalemo-frontend
    # 重启策略：总是重启
    restart: always
    # 端口映射：主机的8080端口映射到容器的80端口
    ports:
      - '80:80'
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
    # 环境变量
    environment:
      - NODE_ENV=production
    # 健康检查
    healthcheck:
      test:
        [
          'CMD',
          'wget',
          '--no-verbose',
          '--tries=1',
          '--spider',
          'http://localhost:80/',
        ]
      interval: 30s
      timeout: 10s
      retries: 3
